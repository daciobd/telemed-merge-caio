<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TeleMed — Hub de Integração</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
      --primary:#0ea5e9; --border:#1e293b; --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .grid{display:grid;gap:16px}
    @media(min-width:980px){ .grid-3{grid-template-columns:1fr 1fr 1fr} .grid-2{grid-template-columns:1fr 1fr} }
    .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:18px}
    h1{margin:0 0 10px;font-size:26px}
    h2{margin:0 0 12px;font-size:18px}
    .muted{color:var(--muted)}
    label{display:block;font-size:13px;color:#cbd5e1;margin:8px 2px 6px}
    input{width:100%;background:#0b1220;border:1px solid var(--border);border-radius:12px;color:var(--text);padding:10px 12px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);cursor:pointer;color:#fff;background:var(--primary);font-weight:600}
    .btn.ghost{background:transparent;color:#93c5fd}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;border:1px solid var(--border);background:#0b1530}
    .ok{color:#4ade80} .bad{color:#f87171}
    .routes a{display:block;margin:8px 0 0;color:#93c5fd;text-decoration:none}
    .routes a:hover{text-decoration:underline}
    pre{white-space:pre-wrap;background:#0b1220;border:1px solid var(--border);border-radius:12px;padding:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>TeleMed — Hub de Integração</h1>
    <p class="muted">Defina as URLs dos serviços, salve, e use os testes abaixo. As URLs ficam no <code>localStorage</code>.</p>

    <!-- Config -->
    <div class="card">
      <h2>Configurar URLs</h2>
      <div class="grid grid-3">
        <div>
          <label>AUCTION_URL</label>
          <input id="AUCTION_URL" placeholder="https://telemed-auction.onrender.com">
        </div>
        <div>
          <label>INTERNAL_URL</label>
          <input id="INTERNAL_URL" placeholder="https://telemed-internal.onrender.com">
        </div>
        <div>
          <label>PRODUCTIVITY_URL</label>
          <input id="PRODUCTIVITY_URL" placeholder="https://telemed-productivity.onrender.com">
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <button id="save" class="btn">Salvar</button>
        <button id="clear" class="btn ghost">Limpar (localStorage)</button>
        <span class="muted">Dica: depois de salvar, faça um hard refresh (Ctrl/Cmd+Shift+R) se algo não aparecer.</span>
      </div>
    </div>

    <!-- Status -->
    <div class="grid grid-3" style="margin-top:16px">
      <div class="card">
        <h2>AUCTION</h2>
        <div class="row" style="justify-content:space-between">
          <span class="pill">URL: <span id="badge-auction" class="muted"></span></span>
          <button class="btn" id="test-auction">Testar /healthz</button>
        </div>
        <div id="out-auction" style="margin-top:10px" class="muted"></div>
      </div>

      <div class="card">
        <h2>INTERNAL</h2>
        <div class="row" style="justify-content:space-between">
          <span class="pill">URL: <span id="badge-internal" class="muted"></span></span>
          <button class="btn" id="test-internal">Testar /healthz</button>
        </div>
        <div id="out-internal" style="margin-top:10px" class="muted"></div>
      </div>

      <div class="card">
        <h2>PRODUCTIVITY</h2>
        <div class="row" style="justify-content:space-between">
          <span class="pill">URL: <span id="badge-prod" class="muted"></span></span>
          <button class="btn" id="test-prod">Testar /healthz</button>
        </div>
        <div id="out-prod" style="margin-top:10px" class="muted"></div>
      </div>
    </div>

    <!-- Rotas úteis -->
    <div class="grid grid-2" style="margin-top:16px">
      <div class="card routes">
        <h2>Páginas de Demo</h2>
        <a href="/cadastro.html">Cadastro de Paciente</a>
        <a href="/cadastro-medico.html">Cadastro de Médico</a>
        <a href="/demo.html">Demo Médico (BIDs / Accept)</a>
        <a href="/video.html">Sala de Vídeo (Jitsi)</a>
        <a href="/scribe-demo.html">Scribe Demo (CID-10)</a>
      </div>
      <div class="card">
        <h2>Exemplo de uso (curl)</h2>
        <p class="muted">Copie, troque os IDs e rode no terminal:</p>
        <pre id="curlbox"></pre>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const $ = s => document.querySelector(s);

    // Carregar/salvar config em localStorage
    const keys = ['AUCTION_URL','INTERNAL_URL','PRODUCTIVITY_URL'];
    function load(){
      keys.forEach(k=>{
        const v = localStorage.getItem(k) || '';
        $('#'+k).value = v;
      });
      updateBadges();
      renderCurl();
    }
    function save(){
      keys.forEach(k=>{
        const v = $('#'+k).value.trim().replace(/\/$/,'');
        if (v) localStorage.setItem(k, v); else localStorage.removeItem(k);
      });
      updateBadges();
      renderCurl();
    }
    function clearAll(){
      keys.forEach(k=>localStorage.removeItem(k));
      load();
    }
    function get(k){ return (localStorage.getItem(k) || '').replace(/\/$/,''); }

    // UI
    function updateBadges(){
      $('#badge-auction').textContent  = get('AUCTION_URL')      || '(não definido)';
      $('#badge-internal').textContent = get('INTERNAL_URL')     || '(não definido)';
      $('#badge-prod').textContent     = get('PRODUCTIVITY_URL') || '(não definido)';
    }

    async function ping(url, outEl){
      if (!url){ outEl.innerHTML = '<span class="bad">URL não configurada.</span>'; return; }
      outEl.textContent = 'Testando...';
      try{
        const r = await fetch(url.replace(/\/$/,'') + '/healthz');
        const txt = await r.text();
        outEl.innerHTML = r.ok
          ? `<span class="ok">OK</span> ${txt}`
          : `<span class="bad">Falhou</span> ${r.status} ${txt}`;
      }catch(e){
        outEl.innerHTML = `<span class="bad">Erro:</span> ${e.message}`;
      }
    }

    function renderCurl(){
      const a = get('AUCTION_URL') || 'https://telemed-auction.onrender.com';
      $('#curlbox').textContent =
`# Criar BID (troque patientId e specialty)
curl -X POST ${a}/bids \\
  -H "Content-Type: application/json" \\
  -d '{"patientId":"12345678901","amountCents":9000,"mode":"immediate","specialty":"Cardiologia"}'

# Aceitar BID
curl -X POST ${a}/bids/<BID_ID>/accept \\
  -H "Content-Type: application/json" \\
  -d '{"patientId":"12345678901"}'`;
    }

    // eventos
    $('#save').onclick = save;
    $('#clear').onclick = clearAll;
    $('#test-auction').onclick  = ()=> ping(get('AUCTION_URL'),  $('#out-auction'));
    $('#test-internal').onclick = ()=> ping(get('INTERNAL_URL'), $('#out-internal'));
    $('#test-prod').onclick     = ()=> ping(get('PRODUCTIVITY_URL'), $('#out-prod'));

    load();
  })();
  </script>
</body>
</html>