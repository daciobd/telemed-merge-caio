<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro Concluído – TeleMed</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --muted:#94a3b8; --text:#e2e8f0;
      --primary:#0ea5e9; --primary-2:#0284c7; --ok:#22c55e; --warn:#f59e0b;
      --radius:14px; --border:#1e293b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text); font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      display:flex; align-items:center; justify-content:center; padding:32px;
    }
    .card{
      width:min(580px,100%); background:var(--panel); border:1px solid var(--border);
      border-radius:var(--radius); padding:32px; box-shadow:0 10px 30px rgba(0,0,0,.25);
      text-align:center;
    }
    .success-icon{
      width:64px; height:64px; background:var(--ok); border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:32px; margin:0 auto 24px; color:white;
    }
    h1{margin:0 0 16px; font-size:28px; color:var(--ok)}
    p{color:var(--muted); margin:16px 0}
    .patient-id{
      background:#0b1530; border:1px solid var(--border); border-radius:12px;
      padding:16px; margin:20px 0; font-family:monospace; font-size:18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .btn{
      padding:12px 16px; border-radius:12px; border:1px solid var(--border);
      color:var(--text); background:#0b1530; cursor:pointer; font-weight:600;
      text-decoration:none; display:inline-block; margin:8px;
      transition:all 0.2s ease;
    }
    .btn:hover{filter:brightness(1.15)}
    .btn.primary{background:linear-gradient(180deg, var(--primary), var(--primary-2)); border-color:#065f92; color:#fff}
    .btn.outline{background:transparent; color:var(--primary); border-color:var(--primary)}
    .actions{margin-top:24px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap}
    .link-row{margin-top:20px; display:flex; gap:16px; justify-content:center; flex-wrap:wrap}
    .link-row a{color:#93c5fd; text-decoration:none; font-weight:600}
    .link-row a:hover{text-decoration:underline}
    @media(max-width:540px){.actions{flex-direction:column} .btn{margin:4px 0}}
  </style>
</head>
<body>
  <main class="card">
    <div class="success-icon">✅</div>
    
    <h1>Cadastro concluído!</h1>
    
    <p>Seu cadastro foi realizado com sucesso. Guarde seu <strong>Patient ID</strong> para futuras consultas:</p>
    
    <div class="patient-id">
      <span id="patient-id-display">-</span>
      <button id="copy-btn" class="btn" style="padding:8px 12px; margin:0">Copiar ID</button>
    </div>
    
    <div class="actions">
      <a id="bid-link" class="btn primary" data-testid="button-fazer-pedido">Fazer pedido de consulta</a>
      <a id="waiting-room-link" class="btn outline" data-testid="button-sala-espera">Ir para Sala de Espera</a>
    </div>
    
    <div class="link-row">
      <a href="/cadastro.html" data-testid="link-novo-cadastro">← Novo cadastro</a>
      <span style="color:var(--muted)">·</span>
      <a href="/example-integration.html" data-testid="link-hub">Hub de integração</a>
    </div>
  </main>

  <script>
    // Resgatar patientId da URL ou localStorage
    const urlParams = new URLSearchParams(window.location.search);
    const patientId = urlParams.get('patientId') || localStorage.getItem('patientId') || '';
    
    // Exibir o ID
    const displayEl = document.getElementById('patient-id-display');
    if (displayEl) displayEl.textContent = patientId || 'ID não encontrado';
    
    // Configurar links com patientId
    const bidLink = document.getElementById('bid-link');
    const waitingLink = document.getElementById('waiting-room-link');
    
    if (patientId) {
      bidLink.href = `/paciente/pedido.html?patientId=${encodeURIComponent(patientId)}`;
      waitingLink.href = `/sala-de-espera.html?appointmentId=&patientId=${encodeURIComponent(patientId)}`;
    } else {
      bidLink.href = `/paciente/pedido.html`;
      waitingLink.href = `/sala-de-espera.html`;
    }
    
    // Funcionalidade de copiar ID
    document.getElementById('copy-btn').addEventListener('click', () => {
      if (!patientId) {
        alert('ID do paciente não encontrado.');
        return;
      }
      
      navigator.clipboard.writeText(patientId).then(() => {
        const btn = document.getElementById('copy-btn');
        const originalText = btn.textContent;
        btn.textContent = 'Copiado ✓';
        btn.style.background = 'var(--ok)';
        
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.background = '';
        }, 2000);
      }).catch(() => {
        // Fallback para navegadores mais antigos
        const textArea = document.createElement('textarea');
        textArea.value = patientId;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('ID copiado para área de transferência!');
      });
    });
  </script>
</body>
</html>